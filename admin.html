<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>主辦方控制</title>
</head>
<body>
<h2>倒數控制台</h2>
<button id="startBtn">開始倒數 3 秒</button>

<h3>搶答紀錄</h3>
<ul id="list"><li>尚無搶答</li></ul>

<script>
const channel = new BroadcastChannel('quiz_channel');
const startBtn = document.getElementById('startBtn');
const listEl = document.getElementById('list');
let firstBuzz = null;

startBtn.onclick = () => {
  firstBuzz = null;
  listEl.innerHTML = '<li>尚無搶答</li>';

  // 通知清空上一題
  channel.postMessage({ action:'newQuestion' });

  let timeLeft = 3;
  const interval = setInterval(()=>{
    timeLeft--;
    channel.postMessage({ action:'countdown', timeLeft });
    if(timeLeft<=0){
      clearInterval(interval);
      channel.postMessage({ action:'enableBuzz' });
    }
  },1000);
};

// 接收搶答訊息
channel.onmessage = (e)=>{
  const data = e.data;
  if(data.action==='buzz'){
    if(!firstBuzz){
      firstBuzz = data.employeeId;
      // 通知顯示頁面更新第一名
      channel.postMessage({ action:'firstPlace', employeeId:firstBuzz });
    }
    const li = document.createElement('li');
    li.textContent = `${data.employeeId} 搶答時間: ${data.time}`;
    if(listEl.querySelector('li')?.textContent==='尚無搶答'){
      listEl.innerHTML='';
    }
    listEl.appendChild(li);
  }
};
</script>
</body>
</html>
