<p>倒數剩餘: <span id="countdown">等待開始</span></p>
<button id="startBtn">開始倒數 3 秒</button>
<ul id="list"><li>尚無搶答</li></ul>

<script>
const channel = new BroadcastChannel('quiz_channel');
const startBtn = document.getElementById('startBtn');
const countdownEl = document.getElementById('countdown');
const listEl = document.getElementById('list');
let firstBuzz = null;

startBtn.onclick = () => {
  firstBuzz = null;
  listEl.innerHTML = '<li>尚無搶答</li>';

  // 通知清空上一題紀錄
  channel.postMessage({ action: 'newQuestion' });
  localStorage.setItem('buzzOpen', 'false');  // 重置搶答狀態，手機端也會知道

  let timeLeft = 3;
  countdownEl.textContent = timeLeft;

  const interval = setInterval(() => {
    countdownEl.textContent = timeLeft;               // 顯示主辦方倒數
    channel.postMessage({ action: 'countdown', timeLeft }); // 傳給參賽者

    timeLeft--;
    if (timeLeft < 0) {
      clearInterval(interval);
      countdownEl.textContent = "開始搶答!";
      channel.postMessage({ action: 'enableBuzz' }); // 開放搶答
      localStorage.setItem('buzzOpen', 'true');      // 同步給手機端
    }
  }, 1000);
};

// 接收搶答訊息
channel.onmessage = (e) => {
  const data = e.data;
  if (data.action === 'buzz') {
    if (!firstBuzz) {
      firstBuzz = data.employeeId;
      channel.postMessage({ action: 'firstPlace', employeeId: firstBuzz });
    }
    const li = document.createElement('li');
    li.textContent = `${data.employeeId} 搶答時間: ${data.time}`;
    if(listEl.querySelector('li')?.textContent==='尚無搶答'){
      listEl.innerHTML='';
    }
    listEl.appendChild(li);
  }
};
</script>
